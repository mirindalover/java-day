
#### 京东

##### Presto查询服务

1、使用SpringBoot启动项目，通过JSF提供RPC调用

2、使用Redis进行数据缓存、查询控制

3、使用MySQL记录查询详情，记录慢SQL；热点SQL

4、使用JMQ进行上游表更新监听。刷新缓存保证数据一致性；根据热点SQL和表更新通知来预测

5、请求合并来减少重复查询。查询error和空值查询缓存合适时间，防止用户一致刷新给数据库压力

6、缓存过期由0点过期。改为惰性过期(用户访问时 判断依赖的表更新时间和缓存结果的时间前后关系)


##### BI分析平台

1、使用SpringBoot启动项目，MyBatis进行Mysql连接用来保存用户数据集、图表、看板、门户等数据

2、使用Redis进行业务维度缓存，更新业务缓存失效

3、使用JSF进行微服务之间调用，如：异步调用查询服务，拿到ID后再循环调用拿结果

4、核心是SQL拼接引擎+衍生字段

> SQL拼接：基于数据集的BaseSQL作为子查询。图表的维度、度量、筛选、函数、排序作为最外层查询来拼接

5、邮件订阅由于频繁扫描，单独拆成一个数据库和微服务，辅助BI

> 通过Schedule识别不同的任务

> 通过Mysql状态保证任务不重复执行

> 通过MQ削峰填谷来消费任务，减少查询引擎的压力

6、权限

> 数据都在同一个仓库下，不尽兴隔离
>
> 分析师可以分享数据集、图表、看板给普通用户。用户可以进行复制
>
> 行级权限通过查询出来后直接返回null来控制


#### 哗啦啦

##### 老板通

1、使用SpringBoot启动服务，通过GRPC进行RPC调用，使用etcd作为注册中心

2、MySQL用途很少，只用来保存每个用户在app的功能。如：自主分析、预警、智能分析报告、反馈等

3、数据库使用了TiDB、Spark、Doris来分别对应不同的查询场景

> TiDB用来查询概览页的图表(简单的聚合查询)，TiDB吞吐比较高，SQL不复杂

> Spark用来查询预警、生成智能分析报告等后台运行,数据比较大的的功能

> Doris用来做专题等，稍微复杂的SQL。来保证查询速度


##### HBI

1、使用SpringCloud启动服务，使用openfeign进行rpc调用，使用eureka作为注册中心

2、数据源有Spark(常见的查询)、Doris(开启加速)、TiDB(实时数据)

3、HBI有自己的私仓，来保证数据隔离、物化合表等功能。同时支持开启高速表，来吧数据导入到Doris去查询提速

4、核心SQL引擎：采用 with as 分层使sql逻辑更清晰。虚拟字段类似直接写sql

5、权限

> 数据权限通过Hive中的库来隔离各个集团
>
> 行级权限通过admin赋权时添加筛选

6、模版分发可通过分析师建仪表盘来给用户使用

> 直接复制对应的原子表和合表
>
> 图表和仪表盘不可更改，也不复制，直接使用同一套









