
### 老板通

服务启动、rpc、注册中心、MQ、redis、定时任务、DB


#### 项目架构

3层
api层-sql引擎层-数据查询
api层:鉴权，第代码平台中图表详情。预警、分析报告
sql引擎层:图表对应的sql，包括聚合、同环比、占比高计算子
数据查询层:数据源链接，缓存 



1、使用Spring-boot+GPRC+etcd

2、使用Nacos做动态配置服务

3、引入RabbitMQ做消息队列。用于预警，发送通知触发智能分析报告

4、引入Redis来缓存业务数据库，以及查询数据

5、数据库。80%来自TiDb的离线数据，15%来自Doris做分析用。Hive只用来做智能分析报告的查询

优化：

1、sql in 筛选使用 left join

#### 项目重要功能点的架构设计


##### 低代码+Sql引擎

1、指标、维度定义

定义通用维度(日期、店铺id等)

定义与表关联的维度、度量

定义计算度量:使用sql片段的形式(如SUM(A)+sum(B))

2、数据源表定义

拆分成了 dim表、数据表(关联时间粒度)

表中字段名称不一致问题做了映射

3、sql拼接

根据低代码平台的配置，取出对应的维度、度量、筛选等

sql引擎进行多表join拼接sql。支持同环比和占比


##### 分析报告+智能分析报告





##### 乞丐版数据缓存

由于流量大，redis只能缓存部分数据



#### etcd

- 原理


#### Grpc

- 原理
