
### JBI

服务启动、rpc、注册中心、MQ、redis、定时任务、DB


#### 项目架构

1、使用Spring-boot+JSF

2、使用JMQ。用来监听数仓作业情况。邮件订阅的解耦

4、引入Redis来缓存业务数据库，以及查询数据

5、数据源丰富。分为sql、KV、

#### 项目重要功能点的架构设计

##### 邮件订阅


##### Presto查询服务

- 缓存如何设计

1、接受到查询后，判断是否是实时表(redis有个列表判断)

2、查询redis中是否有缓存数据且数据有效(对应如何存数据)

> 对比上次所有table对应table刷新时间与现在table最新刷新时间

3、缓存没有用，直接排队查询Presto

4、结果返回后，保存到redis

5、异步使用redis hash保存这次查询对应table和table更新日期

> 其实这里直接用时间戳当查询的结果也可以。但是可能会与时钟问题，用hash直接记录这样最准确

a、接受到mq后，根据hotsql和sql执行时间平均时长，设置快慢队列


- 查询怎么减少对数据库压力

1、用户查询直接放到线程池中，用线程池减少数据库压力

2、预测缓存有个定时任务，定时去redis队列获取，先获取快队列。再获取慢队列


##### SQL拼接怎么拼接



#### JSF

使用zk作为注册中心有很多问题
1、cp架构，选主时 服务不可用
2、只有主节点写数据，瞬时流量大时，容易异常
3、zk文件过多时，性能下降

所以注册中心采用的消息总线的方式，即采用的最终一致性
> 注册中心接受到新注册后，通过消息的方式发送给消费者(相当于主动推)

消费者会定时主动拉去新的服务节点


#### JMQ

基于Kafka

- 原理


#### Presto

- 架构

- 优势



